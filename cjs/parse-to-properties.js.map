{"version":3,"sources":["../src/parse-to-properties.js"],"names":["parse","parseToProperties","entriesToProperties","parseToPropertiesOptions","input","options","entries","properties","entry","key","element","unescapeProperty","namespace","namespacedKey","parseNamespace","property","forEach","name","i","length","output","replace","match","code","SyntaxError","String","fromCharCode","parseInt","escaped","split"],"mappings":"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","file":"parse-to-properties.js","sourcesContent":["import { parseToEntries } from './parse-to-entries';\nimport { parseOptions } from './options';\n\n\nconst parseToPropertiesOptions = [\n  'namespace',  // Parse dot separated keys as namespaced\n];\n\n\n/**\n * Parse .properties file content to a properties object, with property key as\n * the key and property element as the value.\n *\n * Alias of parseToProperties\n *\n * @param {string} input Properties file content in string.\n * @param {*} [options] Options for parsing.\n * @returns {object} Parsed result in properties object.\n */\nexport function parse(input, options) {\n  return parseToProperties(input, options);\n}\n\n/**\n * Parse .properties file content to a properties object, with property key as\n * the key and property element as the value.\n * @param {string} input Properties file content in string.\n * @param {*} [options] Options for parsing.\n * @returns {object} Parsed result in properties object.\n */\nexport function parseToProperties(input, options) {\n  let entries = parseToEntries(input);\n  return entriesToProperties(entries, options);\n}\n\n/**\n * Convert parsed entries to a properties object.\n * @param {Array} entries Entries to be converted.\n * @param {Object} [options] Options for converting\n * @returns {object} Converted properties object.\n */\nexport function entriesToProperties(entries, options) {\n  options = parseOptions(options, parseToPropertiesOptions);\n  let properties = {};\n\n  for (let entry of entries) {\n    // Only key and element are relevant\n    let { key, element } = entry;\n\n    // Blank and comment lines are ignored\n    if (key === null) continue;\n\n    // Parsed array adheres to what user authored,\n    // while in properties, we need to unescape backslashes.\n    key = unescapeProperty(key);\n    element = unescapeProperty(element);\n\n    // Assign to properties by key, later entries overwrite previous ones\n    if (options.namespace) {\n      let namespacedKey = parseNamespace(key);\n      let property = properties;\n      namespacedKey.forEach((name, i) => {\n        // This is the last component of the key\n        if (i === namespacedKey.length - 1) {\n          property[name] = element;\n          return;\n        }\n\n        // This is part of the namespace\n        if (name in property) {\n          // Namespace itself and keys under it may all have values\n          // e.g. \"foo = bar\" \"foo.qux = quux\"\n          if (typeof property[name] === 'string') {\n            // Make value of namespace a value of an empty key under the\n            // namespace\n            property[name] = { '': property[name] };\n          }\n        } else {\n          property[name] = {};\n        }\n        property = property[name];\n      });\n    } else {\n      properties[key] = element;\n    }\n  }\n\n  return properties;\n}\n\n\n/**\n * Unescape backslash escaped sequences.\n * @param {string} input String to be mutated.\n * @returns {string} Unescaped input.\n * @throws {SyntaxError} Invalid Unicode escape sequence\n */\nfunction unescapeProperty(input) {\n  // Unescape unicode\n  let output = input.replace(/\\\\u([0-9A-Fa-f]{0,4})/g, (match, code) => {\n    if (code.length !== 4) throw new SyntaxError('Invalid Unicode escape sequence');\n    return String.fromCharCode(parseInt(code, 16));\n  });\n\n  // Unescape other single character\n  return output.replace(/\\\\(.)/g, (match, escaped) => {\n    switch (escaped) {\n      case 'f': return '\\f';\n      case 'n': return '\\n';\n      case 'r': return '\\r';\n      case 't': return '\\t';\n      default: return escaped;\n    }\n  });\n}\n\n/**\n * Turn dot separated string into an array of relevant components.\n * @param {string} key The dot separated string.\n * @returns {Array} Array of key components.\n */\nfunction parseNamespace(key) {\n  return key.split('.');\n}\n"]}